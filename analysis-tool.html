<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Analysis Tool • KIMHUBFX</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="topbar">
  <div class="left">
    <button class="icon-btn" onclick="appUI.openMenu()">☰</button>
    <span class="logo">KIMHUBFX</span>
  </div>
  <div id="authContainer"></div>
</header>

<nav class="horizontal-menu">
  <div class="menu-item" onclick="location.href='dashboard.html'">Dashboard</div>
  <div class="menu-item active">Analysis Tool</div>
  <div class="menu-item" onclick="location.href='dp-tool.html'">DP Tool</div>
  <div class="menu-item" onclick="location.href='freebots.html'">FreeBots</div>
  <div class="menu-item" onclick="location.href='bot-builder.html'">Bot Builder</div>
</nav>

<main class="container">
  <div class="card">
    <h2>Analysis Tool</h2>

    <label>Select Volatility</label>
    <select id="marketSelector">
      <option value="R_10">Volatility 10</option>
      <option value="R_25">Volatility 25</option>
      <option value="R_50">Volatility 50</option>
      <option value="R_75">Volatility 75</option>
      <option value="R_100" selected>Volatility 100</option>

      <option value="R_10_1S">Volatility 10 (1s)</option>
      <option value="R_25_1S">Volatility 25 (1s)</option>
      <option value="R_50_1S">Volatility 50 (1s)</option>
      <option value="R_75_1S">Volatility 75 (1s)</option>
      <option value="R_100_1S">Volatility 100 (1s)</option>
    </select>

    <button id="connectBtn">Connect</button>
    <button id="disconnectBtn">Disconnect</button>

    <div style="margin-top:20px">
      <h3>Last Digit</h3>
      <div id="lastDigitBox" style="font-size:40px;font-weight:900">-</div>
    </div>

    <div style="margin-top:20px">
      <h3>Digit % Distribution (0 - 9)</h3>
      <div id="digitPercentages"></div>
    </div>

    <div style="margin-top:20px">
      <h3>Live Tick</h3>
      <div id="liveTick" style="font-size:22px;font-weight:700">-</div>
    </div>

  </div>
</main>

<script src="menu.js"></script>
<script src="app.js"></script>
<script src="market-engine.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  appUI.renderAuthButtons("authContainer");

  const engine = window.marketEngine;
  const marketSelector = document.getElementById("marketSelector");
  const lastDigitBox = document.getElementById("lastDigitBox");
  const digitPercentages = document.getElementById("digitPercentages");
  const liveTick = document.getElementById("liveTick");

  function renderPercentages(stats) {
    digitPercentages.innerHTML = "";
    const counts = stats.digitsCount;
    const total = counts.reduce((a, b) => a + b, 0);

    for (let i = 0; i < 10; i++) {
      const pct = total ? ((counts[i] / total) * 100).toFixed(2) : "0.00";
      const div = document.createElement("div");
      div.style.padding = "8px";
      div.style.margin = "4px 0";
      div.style.background = "#fff";
      div.style.borderRadius = "6px";
      div.style.fontWeight = "700";
      div.innerText = `${i} → ${pct}%`;
      digitPercentages.appendChild(div);
    }
  }

  engine.on("tick", () => {
    const s = engine.getStats();
    liveTick.innerText = s.latestPrice || "-";
    lastDigitBox.innerText = s.lastDigit ?? "-";
    renderPercentages(s);
  });

  document.getElementById("connectBtn").onclick = () => {
    engine.connect({
      market: marketSelector.value,
      historySize: 300,
    });
  };

  document.getElementById("disconnectBtn").onclick = () => {
    engine.disconnect();
  };
});
</script>

</body>
</html>
